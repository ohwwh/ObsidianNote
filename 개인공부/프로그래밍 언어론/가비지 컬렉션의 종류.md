## 요약
---


## 개념
---
- 가비지 컬렉션(Garbage Collection, GC)란?
	- 프로그램이 동적으로 할당한(= 힙 영역에 할당한) 메모리가 필요 없어지면(= 가비지) 자동으로 해제(컬렉션) 해 주는 것
	- 

## 종류
---
1. Tracing
2. Reference Counting

## 1.  Tracing
---
- root object로부터 접근 가능한 객체인지 추적하여 접근 불가능 한 경우 쓰레기로 간주하고 해제하는 기법
	- root object란?
		-  GC가 수집 대상인지 아닌지를 판단하는 기준. 아래와 같은 객체들을 의미한다
			- 각 스레드가 수행중인 메서드 로컬변수
			- CPU 레지스터 변수가 가지고있는 참조
			- 사용중인 각 타입(클래스)의 정적필드
			- 전역변수
### 1.1 mark & sweep
---
- 가장 간단한 Tracing 방식
	- 프로그램 실행 중, 프로그램을 통째로 정지시킨다(stop the world)
		- 프로그램 실행 도중 메모리가 변경되면 마킹을 다시 해야 하기 때문
	- 별도의 스레드에서 GC를 실행시킨다
	- Root로 부터 추적하여 접근 가능한 메모리를 마킹한다
		- 마킹 정보는 객체의 header에 flag를 넣거나, 별도의 BitmapTable을 쓰는 식으로 관리
	- 마킹되지 않은 메모리는 전부 해제(sweep)한다.
	- 살아남은 객체의 마킹 정보를 초기화 한다
- 문제점
	1. Freezing
		- 프로그램을 통째로 정지시키기 때문에, 프로그램이 뚝뚝 끊길 수 있다
		- 해결책
			- Incremental GC(Tri-color marking)
			- Generational GC
	1. Memory Fragmentation
		- 해제될 메모리가 순서대로 있는 것이 아니기 때문에, 메모리를 해제한 후 메모리가 듬성 듬성 떨어져 있는 메모리 단편화(Memory Fragmentation)이 생기게 된다
		- 해결책
			- mark & sweep & compaction
			- Copying Algorithm

### 1.2 Incremental GC
---
- mark & sweep 을 점진적으로 나누어서 하는 방식
- 마킹을 접근 가능 / 불가능 2가지가 아닌, 3가지로 하는 방식
	- 흰색: 접근 가능한지 알 수 없음
	- 회색: 접근 가능하지만, 해당 메모리에서 참조하는 메모리들은 아직  마킹하지 않음
	- 검은색: 접근 가능하며, 해당 메모리에서 참조하는 메모리도  마킹 완료
- 마킹 순서
	1. root 메모리가 참조하는 메모리를 조사하여, 흰색인 메모리를 모두 회색으로 마킹
	2. 회색으로 마킹된 메모리들이 각각 참조하는  메모리를 조사하여, 모두 회색으로 마킹
	3. 처음 회색이었던 메모리를 검은색으로 마킹
	4. 위 작업을 재귀적으로 반복
- 이러한 방식을 사용한다면, GC가 중단되어도 나중에 회색인 메모리 부터 다시 조사하면 되므로 GC를 여러 번에 걸쳐 나누어 수행할 수 있다.
- 문제점
	1. GC가 중단된 와중에, 검은색으로 마킹된 메모리의 모든 참조가 갑자기 끊기면?
		- 이 경우는 쓰레기임에도 해제가 안 되는 메모리 낭비의 선에서 끝남
		- 해결책
			- read barrier
	2.  흰색으로 마킹되었고 이미 검사가 끝난 메모리( = GC가 쓰레기로 간주할)를 어떤 객체가 참고하게 된다면?
		- 이 경우는 멀쩡히 누군가가 참고하는 메모리를 없애버리므로 null 참조 or 쓰레기 값에 대한 참조가 일어날 수 있으므로 최악의 상황
		- 해결책
			- write barrier
	3. 해결책: write / read barrier
		- 모든 읽기 / 쓰기 작업 전 실행되는 일종의 서브 루틴
		- C#의 경우 CLR에서 JIT 컴파일 수행 시 코드 조각(snippet)을 자동으로 삽입한다.
		- 이 삽입되는 코드에서, card table이라는 bitmap 자료구조에 "검사가 끝난" 오브젝트들의 참조 상태를 기록한다.
- write barrier
	- 포인터에 쓰는 작업(참조 관계 생성)을 추적하여, 해당 작업(write access)이 흰색 마킹된 메모리에 발생한 경우 마킹의 색을 회색으로 바꾸는 작업.
	- 어떻게 추적하는가: card table
### 1.3 mark & sweep & compaction
### 1.4 Copying Algorithm
### 1.5 Generational GC
## 2. Reference Counting
---