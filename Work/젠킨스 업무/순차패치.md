
## 개념
---
- 순차패치란 점검의 경우 공지 후 서버를 내리고 패치 작업 후 서버를 올린다면, 순차 패치는 이런 식으로 패치 작업 동안 접속이 불가능한 시간을 최소한으로 줄이기 위해 예비 서버군을 두고 해당 서버에 패치를 반영 후 기존 서버 유저들을 여기로 붙이는 방식으로 이루어진다.
    - 우선 순차 패치를 위해 QA에서 import 해온 서버 바이너리를, 신서버에 복사해온다(패치 or prepare)
    - 준비된 신 서버 중 절반(앞 채널)을 실행시킨다.
    - 기존 서버 중 앞 절반의 유저들을 공지 후 킥 하면
    - 새롭게 실행된 신 서버군으로 유저들이 다시 붙게 된다.
    - 이 후 이사가 완료된 기존 서버를 내리고, 나머지 절반 기존 서버(뒷 채널)에 대해 동일한 작업을 반복한다
    - 왜 이런 식으로 절반씩 하냐 하면, 하나의 머신의 메모리가 서버 9개 까지는 감당하지만 12개를 감당하기엔 부족하기 때문.
    - 이런 순차 패치를 위해, 각 게임 서버(각 채널 - 하나의 프로세스)들은 Sort라는 값으로 관리된다. 이 키의 값을 보면 Channel01, Channel02 같은 식으로 분류 되어 있다. 이는 **게임 채널과는 다르다.** 위와 같이 앞 채널, 뒷 채널로 나누어 관리 하기 위한 것이다(이는 매우 헷갈리는 부분. channel보다는 group이라고 하는게 낫지 않았나 싶다). 예를 들어 기존 서버 군이 Channel01 ~ Channel06 이고 신 서버군은 7 ~ 12이다(순차 패치가 완료되면 반대)
    - 하나의 머신은 각기 다른 **채널값(sort)**을 가진 프로세스들을 돌린다. 즉, 서로 두 개의 프로세스가 채널값이 같다면 다른 머신에 존재한다는 의미. 그리고 매우 헷갈리지만, 이 두 프로세스는 채널값**(sort)**이 같은 서로 다른 채널**(게임 채널)**이다.


## 과정
---
DashBoard → BuildAndPatch → Build >> Update(Live) → 파라미터와 함께 빌드
1. import (QA): 마지막으로 QA가 끝난 버전을 import
    - 순차패치가 예정되어 있고, 해당 빌드가 완료되었다면 **미리 시작할 것**
    - 15분 내로 안 끝나면 뭔가 이상한 것
    - 실제 QA 완료된 버전이 import 되었는지 확인 할 것
        - import 잡 맨 위의 버전 정보들은 뭔진 모르겠지만 아마 import 하기 전 정보로 추정. 보지 말 것
        - 빌드현황에 import 메시지를 봐라
2. prepare (nonstoppatch2): 기존 서버 종료 없이, 죽어있던 예비 서버에 패치 내용 업뎃 후 서버 실행 (주의: stoppatch는 정기점검시 서버 멈추고 패치하는 것. 함부로 건드리면 서버 다 내려버리는 수가 있음) → 이걸 순차패치라고 함
    - 순차패치 10 ~ 15분전 미리 돌려서 서버를 띄운 후, monitor로 버전이 맞는지, 제대로 뜨는지 체크
3. inspect: 순차패치된 서버로 유저들 옮김. 다 옮겨지면 구 서버를 죽인다.
    - 이 따금 구 서버를 죽일 때, 덤프가 발생하는 경우가 있다. 순간적인 메모리 점유 이슈로 인해 발생하며 무시해도 무방
