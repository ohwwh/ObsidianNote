## 개념
---
메이플M의 브랜치 분리란, Server, Client, Resource, MiddleWare 의 마스터 브랜치로부터 이제부터 서비스 할 버전의 브랜치를 새로 생성하는 것. 브랜치 분리 전 각각의 저장소에서 어느 커밋부터 브랜치를 생성할 지 해시값을 메일로 받는데, 파라미터로 이걸 넣어주면 된다. 자세한 내용은 아래 컨플을 참조
[https://confluence.nexon.com/pages/viewpage.action?pageId=450458450](https://confluence.nexon.com/pages/viewpage.action?pageId=450458450)


## How to Run
---
1. QA → Stage copy
    
    구 버전의 QA를 Stage에 옮겨둡니다(일종의 백업). 이 시점의 QA는 현재 라이브 서비스 중인 빌드와 동일하며, 따라서 Stage = 현재 라이브 서비스 중인 빌드의 백업 같은 개념으로 생각하면 됩니다. **QA/Stage가 같이 있기 때문에 헷갈리지만, 이 둘의 브랜치 버전은 다릅니다. QA가 최신 브랜치, Stage는 그 전 버전의 브랜치입니다.**
    
    - 순서 상, 브랜치 분리 후 첫 빌드 전에만 이루어지면 된다(꼭 브랜치 분리 전에 해야 하는 건 아님)
2. 브랜치 분리
    
    새로운 버전을 위한 국가별 브랜치를 만듭니다. 젠킨스의 newbranch job을 이용합니다.
    
    - 108로 끝나는 젠킨스의 경우, 빌드를 제외한 잡다한 job들을 분리하여 42 젠킨스의 부하를 줄이고자 새로 만들어졌습니다. 위의 new branch를 만드는 job 역시 여기 속해 있습니다.
    - 해시 값이 잘못 온다던지, 입력을 잘못 한다던지 휴먼 에러가 발생할 수 있다. Console log를 꼭 확인할 것
3. QA 풀빌드
    
    따로 슬랙에 빌드 요청 없어도(보통 메일에 첫 빌드 발행 같은 식으로 요청이 오긴 한다) 브랜치 분리 후 QA 풀 빌드를 해 준다.
    
4. QA 자동 빌드 활성화
    
    검수 이후 꺼져 있던 QA 자동 빌드를 다시 활성화 해준다.
    
5. (선택) beta서버 빌드
    
6. (QA 서버 빌드 완료 후) Stage 서버 빌드
    
    다음 라이브 때 더 빠르게 빌드하기 위해, 미리 게임 서버만 빌드해놓습니다 (역시 선택)



## 중국 브랜치 분리
---
- 현재 중국의 브랜치 분리는 QA 브랜치를 분리하고 원본을 Stage에 백업해 두는 개념이 아니라, 그냥 Stage 브랜치를 분리하는 것
- 하지만 지금 쓰고 있는 newBranch 잡의 경우 QA 브랜치를 분리한다고 가정하고 만들어 졌기 때문에 약간의 야매가 필요하다.
- QA/Stage 둘 다 현재 바꿀 브랜치 이름으로 변경한 후, 브랜치 분리 잡이 끝난 후 QA 브랜치 이름을 원래대로 수정해준다.
- 이후 QA 대신 Stage 풀빌드 해주면 됨

- 중국에서의 QA/Stage
    - 국내에서는 QA가 최신 테스트용, Stage는 라이브 버전의 백업용
    - 하지만 중국은 좀 다르다
        - QA: CBT빌드 - CBT 라이브 진행 할 버전. 현재 0.87은 서비스 중. 4월 이후로는 어떻게 될 지 모르겠다. 5월에 0.8 최종적으로 전달해서 그걸로 버전 바꿔서 CBT를 하려나??
        - Stage: 기술 연동 빌드 - 가장 최신의 빌드로써 따로 QA는 하지 않고, 오직 기술 연동만을 위해 공유하는 빌드
        - 의미가 좀 모호한데, 아마도 최신으로 추가된 컨텐츠를 텐센트에 매주 전달하기 위한 목적으로 추정됨